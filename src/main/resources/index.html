<!DOCTYPE html>
<html>
<head>
</head>
<body>
<div>
    <!-- ============================================================================ -->
    <!-- This content is only used for static prototyping purposes (natural templates)-->
    <!-- and is therefore entirely optional, as this markup fragment will be included -->
    <!-- from "fragments/header.html" at runtime.                                     -->
    <!-- ============================================================================ -->
    <div class="navbar navbar-inverse navbar-fixed-top">
        <div class="container">
            <div class="navbar-header">
                <a class="navbar-brand" href="#">Mandelbrot Visuals Using KNative and Spring Cloud Function</a>
            </div>
            <div class="navbar-collapse collapse">
                <ul class="nav navbar-nav">
                    <li class="active"><a href="#">Home</a></li>
                </ul>
            </div>
        </div>
    </div>
</div>
<div class="container">
    <div class="hero-unit">
        <h1>Mandelbrot</h1>
        <p>
            Welcome!
        </p>
    </div>
    <div>&copy; 2018 Hubau.Cloud</div>
    <canvas id="canvas" width="200" height="200"></canvas>
    <script>
        canvas = document.getElementById('canvas');
        context = canvas.getContext('2d');
        context.clearRect(0, 0, 100, 100);

        var loc = window.location, new_uri;
        if (loc.protocol === "https:") {
            new_uri = "wss:";
        } else {
            new_uri = "ws:";
        }
        new_uri += "//" + loc.host;
        new_uri += "/websocket/calculate";
        var clientWebSocket = new WebSocket(new_uri);
        clientWebSocket.onopen = function () {
            console.log("clientWebSocket.onopen", clientWebSocket);
            clientWebSocket.send(JSON.stringify({
                "type": "CALCULATION",
                "x1": -2.0,
                "y1": -2.0,
                "x2": 2.0,
                "y2": 2.0,
                "depth": 2
            }));
        };
        clientWebSocket.onclose = function (error) {
            console.log("clientWebSocket.onclose", clientWebSocket, error);
        };
        clientWebSocket.onerror = function (error) {
            console.log("clientWebSocket.onerror", clientWebSocket, error);
        };
        clientWebSocket.onmessage = function (event) {
            var d = JSON.parse(event.data);
            context.fillStyle = "rgb(" + d.color + "," + d.color + "," + d.color + ")";
            context.fillRect(d.x1, d.y1, 1, 1);
        }
    </script>
</div>
</body>
</html>